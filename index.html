<!doctype html>
<html>
<head>
</head>
<body>
<button id="start">start</button>
<button id="stop">stop</button>
<script src="index.js"></script>
<script>
  let context = new AudioContext();
  let osc;
  let env;

  function start() {
    stop();
    osc = context.createOscillator();
    osc.type = 'triangle';
    osc.frequency.value = 220;

    let gain = context.createGain();
    gain.gain.value = 0;

    env = new Envelope(context, {
      attackTime: 0.1,
      decayTime: 0.5,
      sustainLevel: 0.2,
      releaseTime: 0.01
    });

    osc.connect(gain);

    env.connect(gain.gain);

    gain.connect(context.destination);

    var startAt = context.currentTime;


    osc.start(startAt);
    env.start(startAt);

    var releaseAt = startAt + 0.5;
  }

  function stop() {
    try {
      env.release(context.currentTime);
      osc.stop(env.getReleaseCompleteTime());
    } catch (e) {}
  }
  let startEl = document.getElementById('start')
  let stopEl = document.getElementById('stop')
  startEl.addEventListener('click', start);
  stopEl.addEventListener('click', stop);
</script>
</body>
</html>
